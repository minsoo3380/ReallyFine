<!DOCTYPE html>
<html>
<head lang="ko">
	<meta charset="utf-8">
	<title>Really Fine?</title>
	<script src="../js/jquery-3.4.0.js"></script>
	<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
	<script type="text/javascript">
		$(function(){
			$("#header").load("web_header.html");
		});
		
		$.get("../php/getTopMenu.php?menu=1", function(data){
			$("#topFrame").append(data);
		});
		
		$.get("../php/getNavMenu.php?RFmenu=5", function(data){
			$("#fullFrame").append(data);
		});

		$.get("../php/getLocation.php?district=02", function(data){
			$("#district").append(data);
		});

		$.get("../php/getLocation.php?local=02", function(data){
			$("#local").append(data);
		});
	</script>
	<script type="text/javascript">
		google.charts.load('current', {'packages':['corechart']});
	
		function drawChart_dust(){
			var jsonData = $.ajax({
				url:"../php/getChart.php?section=1001&date=2019-05-01&station=1",
				dataType: "json",
				async: false
			}).responseText;

			var data = new google.visualization.DataTable(jsonData);

			var options = {
				title:'Public Dust Data',
				legend:{position:'bottom'},
				chartArea:{width:'95%', height:'65%'}};

			var chart = new google.visualization.LineChart(document.getElementById('line_chart_dust'));

			chart.draw(data, options);
		}

		function drawChart_AwsLoc(){
			var jsonData = $.ajax({
				url:"../php/getChart.php?section=1101&date=2019-05-01&station=1",
				dataType: "json",
				async: false
			}).responseText;

			var data = new google.visualization.DataTable(jsonData);

			var options = {
				title:'Public AWS Direction value',
				legend:{position:'bottom'},
				chartArea:{width:'95%', height:'65%'},
				colors:['#990099']};

			var chart = new google.visualization.LineChart(document.getElementById('line_chart_AwsLoc'));

			chart.draw(data, options);
		}
	
		function drawChart_Aws(){
			var jsonData = $.ajax({
				url:"../php/getChart.php?section=1201&date=2019-05-01&station=1",
				dataType: "json",
				async: false
			}).responseText;

			var data = new google.visualization.DataTable(jsonData);

			var options = {
				title:'Public AWS Velocity',
				legend:{position:'bottom'},
				chartArea:{width:'95%', height:'65%'},
				colors:['#109618']};

			var chart = new google.visualization.LineChart(document.getElementById('line_chart_AWS'));

			chart.draw(data, options);
		}

		google.charts.setOnLoadCallback(drawChart_dust);
		google.charts.setOnLoadCallback(drawChart_AwsLoc);
		google.charts.setOnLoadCallback(drawChart_Aws);
	</script>

	<script type="text/javascript">
		function changeDist(){
			var district = document.getElementById("district");
			var local = document.getElementById("local");
			
			local.options.length = 0;

			var localData = $.ajax({
				url:"../php/getLocation.php?local=" + district.value,
				dataType:"html",
				async:false
			}).responseText;
			
			$("#local").append(localData);
		}

		function changeLoc(){
			var district = document.getElementById("district");
			var local = document.getElementById("local");
			
		}

		function UpdateChart(){
			var searchDate = document.getElementById("searchDate");
			var district = document.getElementById("district");
			var local = document.getElementById("local");
			
			var DustChart = document.getElementById("line_chart_dust");
			console.log(DustChart);
			DustChart.clearChart();
			//console.log(searchDate.value, district.value, local.value);

			var DustData = $.ajax({
				url:"../php/getChart.php?section=1001&date=" + searchDate.value + "&station=" + local.value,
				dataType:"json",
				async: false
			}).responseText;

			var DirecData = $.ajax({
				url:"../php/getChart.php?section=1101&date=" + searchDate.value + "&station=" + local.value,
				dataType:"json",
				async: false
			}).responseText;

			var AwsData = $.ajax({
				url:"../php/getChart.php?section=1202&date=" + searchDate.value + "&station=" + local.value,
				dataType:"json",
				async:false
			}).responseText;

			console.log(DustData);

			var Dust_options = {
				title:'Public Dust Data',
				legend:{position:'bottom'},
				chartArea:{width:'95%', height:'65%'}};

			var Direc_options = {
				title:'Public AWS Direction value',
				legend:{position:'bottom'},
				chartArea:{width:'95%', height:'65%'},
				colors:['#990099']};

			var Aws_options = {
				title:'Public AWS Velocity',
				legend:{position:'bottom'},
				chartArea:{width:'95%', height:'65%'},
				colors:['#109618']};
			
			var Dust_chart = new google.visualization.LineChart(document.getElementById('line_chart_dust'));
		}
	</script>

	<style>
		.page-wrapper{
			width:1000px;
			margin:0 auto;
		}
	</style>
</head>

<body>
	<div id="header"></div>
	<div id="topFrame"></div>
	<nav id="fullFrame"></nav>
	<div id="dataFrame">
		<div id="selector">
			<select id="district" onchange="changeDist()"></select>
			<select id="local" onchange="changeLoc()"></select>
			<input id="searchDate" name="searchDate" type="date">
			<input id="updateChart" name="updateChart" type="button" value="데이터 검색" onclick="UpdateChart()">
		</div>
		<div class="page-wrapper">
			<br />
			<h2 align="center">Public Fine Dust & AWS Data</h2>
			<div id="line_chart_dust" style="width:100%; height:500px"></div>
			<div id="line_chart_AwsLoc" style="width:100%; height:500px"></div>
			<div id="line_chart_AWS" style="width:100%; height:500px"></div>
		</div>
	</div>
</body>
</html>
