<!DOCTYPE html>
<html>
	<head lang="ko">
		<meta charset="utf-8">
		<title>Really Fine?</title>
		<script src="js/jquery-3.4.0.js"></script>
		<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
		<script type="text/javascript">
			var RFmenu = getQuery('RFmenu');
			var type = null;
			var ServerDate = new Date();
			var Year = ServerDate.getFullYear();
			var Month = ServerDate.getMonth() + 1;
			var Day = ServerDate.getDate();
			var radio_value = 0;
			
			if(Month < 10){
				Month = "0" + Month;
			}

			if(Day < 10){
				Day = "0" + Day;
			}

			var SearchDate = Year + '-' + Month + '-' + Day;

			$(document).ready(function(){
				var input_Date = document.getElementById("searchDate");
				input_Date.value = SearchDate;

				setSearchDate();
				$("#avg_year").val(ServerDate.getFullYear()).prop("selected", true);
				$("#avg_mon").val(Month).prop("selected", true);
				console.log("Month : ", Month);

				$(function(){
					$("#header").load("logo.html");
				});

				$.get("php/getNav.php", function(data){
					$("#nav").append(data);
				});

				$.get("php/getAside.php?RFmenu=" + RFmenu, function(data){
					$("#aside").append(data);
				});
			
				$.get("php/getLocation.php?district=02", function(data){
					$("#district").append(data);
				});
				
				change_Menu(radio_value);
				getTableData();
			});
		
			function setSearchDate(){
				var selector_year = document.getElementById("avg_year");
				var selector_mon = document.getElementById("avg_mon");
				var min_date = 2010;
				
				for(var i = ServerDate.getFullYear();i >= min_date;i--){
					var option = document.createElement("option");
					var option_value = document.createTextNode(i);
					
					option.appendChild(option_value);
					selector_year.appendChild(option);
				}

				for(var i = 0;i <= 12;i++){
					var option = document.createElement("option");
					var option_value = null;
					var text = null;

					if(i == 0){
						text = "월 선택";
					}else if(i < 10){
						text = "0" + i;
					}else{
						text = i;
					}

					option_value = document.createTextNode(text);
					option.appendChild(option_value);
					selector_mon.appendChild(option);
				}	
			}

			function getQuery(param){
				var url = window.location.search.substring(1);
				var url_arr = url.split('&');
				
				for(var i = 0;i < url_arr.length;i++){
					var key_value = url_arr[i].split('=');
					if(key_value[0] == param){
						return key_value[1];
					}
				}
			}

			function change_Menu(value){
				type1 = document.getElementById("DateType1");
				type2 = document.getElementById("DateType2");

				if(value == 0){
					//console.log("radio value : ", radio_value);
					type1.style.display = 'inline';
					type2.style.display = 'none'
					radio_value = 0;
				}else{
					//console.log("radio value : ", radio_value);
					type1.style.display = 'none';
					type2.style.display = 'inline';
					radio_value = 1;
				}
			}

			function getTableData(){
				switch(radio_value){
					case 0:
						$("#data_table").empty();

						value_date = document.getElementById("searchDate").value;
						value_district = document.getElementById("district").value;
						//console.log("discript : ", value_district);
						if(value_district == null || value_district == '')
							value_district = '02';

						param_script = "section=" + RFmenu + "&type=0&district=" + value_district + "&date=" + value_date;

						//console.log(param_script);
						$.get("php/getTable.php?" + param_script, function(data){
							$("#data_table").append(data);
						});

						break;
					case 1:
						$("#data_table").empty();
						value_year = document.getElementById("avg_year").value;
						value_mon = document.getElementById("avg_mon").value;
						
						if(value_district == null || value_district == '')
							value_district = '02';
						
						value_date = value_year + "-" + value_mon;
						//console.log(value_date);
						value_district = document.getElementById("district").value;

						param_script = "section=" + RFmenu + "&type=1&district=" + value_district + "&date=" + value_date;
						
						console.log(param_script);
				
						$.get("php/getTable.php?" + param_script, function(data){
							$("#data_table").append(data);
						});

						break;
				}
			}
		</script>
	</head>
                                                                    
	<body>
		<header id="header">
		</header>

		<nav id="nav">
		</nav>

		<aside id="aside">
		</aside>

		<section id="section">
			<article id="section_title">

			</article>
			<article id="search_head">
				<h5>데이터 구분</h5>
				<input type="radio" id="dataType_day" name="dataType" value="0" onclick="change_Menu(this.value)" checked>
				<label for="dataType_day">시간</label>
				<input type="radio" id="dataType_mon" name="dataType" value="1" onclick="change_Menu(this.value)">
				<label for="dataType_mon">일평균</label>
				<span id="DateType1">
					<input id="searchDate" type="date">
				</span>
				<span id="DateType2">
					<select id="avg_year"></select>
					<select id="avg_mon"></select>
				</span>
				<select id="district"></select>
				<input id="updateTable" name="updateTable" type="button" value="검색" onclick="getTableData()">
				<input id="CallGraph" name="CallGraph" type="button" value="그래프 보기">
				<img src="images/excel.png">
			</article>
		
			<article id="table_atc">
				<table id="data_table" border="1"></table>	
			</article>
		</section>

		<footer id="footer">
		</footer>
	</body>

</html>
